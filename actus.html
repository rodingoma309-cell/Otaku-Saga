<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Otaku Saga - Actus</title>
    <link rel="stylesheet" href="auth.css" />
    <style>
      .actus-list {
        max-width: 1000px;
        margin: 24px auto;
        padding: 0 16px;
      }
      .actus-item {
        background: white;
        padding: 16px;
        border-radius: 8px;
        margin-bottom: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
      }
      .chapter {
        font-weight: 600;
        color: #333;
      }
      .meta {
        color: #7f8c8d;
        font-size: 13px;
        margin-top: 6px;
      }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js"></script>
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-container">
        <div class="logo">
          <h1>üéå Otaku Saga</h1>
        </div>
        <button class="hamburger" id="hamburgerBtn" aria-label="Menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <ul class="nav-menu" id="navMenu">
          <li><a href="accueil.html">Accueil</a></li>
          <li><a href="actus.html" class="active">Actus</a></li>
          <li><a href="service.html">Service</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="apropos.html">√Ä propos</a></li>
          <li><a href="#" id="logoutBtn" class="logout-btn">D√©connexion</a></li>
        </ul>
      </div>
    </nav>

    <main class="main-content">
      <section class="header-section">
        <h1 class="page-title">üì∞ Actualit√©s Manga</h1>
        <p class="page-subtitle">
          D√©couvrez tous les mangas du monde - Plus de 5000 s√©ries disponibles
        </p>
      </section>

      <section class="filter-section">
        <div class="search-box">
          <input
            type="text"
            id="searchInput"
            placeholder="Rechercher un manga..."
          />
          <button id="searchBtn">üîç</button>
        </div>
        <div class="filter-buttons">
          <button class="filter-btn active" data-filter="all">Tous</button>
          <button class="filter-btn" data-filter="shonen">Shonen</button>
          <button class="filter-btn" data-filter="seinen">Seinen</button>
          <button class="filter-btn" data-filter="shoujo">Shoujo</button>
          <button class="filter-btn" data-filter="action">Action</button>
          <button class="filter-btn" data-filter="romance">Romance</button>
        </div>
      </section>

      <section class="mangas-grid" id="mangasGrid">
        <!-- Les mangas seront charg√©s dynamiquement -->
      </section>

      <div class="pagination" id="pagination">
        <!-- La pagination sera g√©n√©r√©e dynamiquement -->
      </div>
    </main>

    <footer class="app-footer">
      <div class="footer-content">
        <h3>üì± Application Mobile Bient√¥t Disponible</h3>
        <p>
          L'application Otaku Saga sera bient√¥t disponible sur vos appareils
          mobiles
        </p>
        <div class="store-buttons">
          <a
            href="#"
            class="store-btn google-play"
            title="Bient√¥t sur Google Play"
          >
            <img
              src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg"
              alt="Google Play"
              style="height: 50px"
            />
            <span class="coming-soon">Bient√¥t disponible</span>
          </a>
          <a href="#" class="store-btn app-store" title="Bient√¥t sur App Store">
            <img
              src="https://tools.applemediaservices.com/api/badges/download-on-the-app-store/black/fr-fr?size=250x83&releaseDate=1285891200"
              alt="App Store"
              style="height: 50px"
            />
            <span class="coming-soon">Bient√¥t disponible</span>
          </a>
        </div>
      </div>
    </footer>

    <script src="app.js"></script>
    <script src="mangas.js"></script>
    <script src="actus.js"></script>
    <script src="common-nav.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDmLoRd1Plxm8TVtHQaIumVZuJIFUkND5k",
        authDomain: "donatien-c5fd7.firebaseapp.com",
        projectId: "donatien-c5fd7",
        storageBucket: "donatien-c5fd7.appspot.com",
        messagingSenderId: "96281887961",
        appId: "1:96281887961:web:0752bc0976cbb3012c6ac8",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      async function loadActus() {
        const listEl = document.getElementById("list");
        const loading = document.getElementById("loading");
        try {
          // r√©cup√©rer derniers documents, ordonner par createdAt desc
          const snap = await db
            .collection("actus")
            .orderBy("createdAt", "desc")
            .limit(50)
            .get();
          loading.style.display = "none";
          if (snap.empty) {
            listEl.innerHTML = "<p>Aucune actualit√© r√©cente.</p>";
            return;
          }
          const html = [];
          snap.forEach((doc) => {
            const data = doc.data();
            const week = data.week || "";
            const title = data.mangaTitle || "Manga";
            const updates = data.updates || [];
            const itemsHtml = updates
              .map(
                (u) => `
              <div>
                <div class="chapter">${
                  u.title || "Chap. " + (u.chapter || "?")
                } ${u.volume ? "(Vol " + u.volume + ")" : ""}</div>
                <div class="meta">${u.language || ""} ‚Äî publi√©: ${new Date(
                  u.publishAt
                ).toLocaleString("fr-FR")} ‚Äî <a href="${
                  u.link
                }" target="_blank" rel="noopener">Voir</a></div>
              </div>
            `
              )
              .join("");
            html.push(`
            <article class="actus-item">
              <h3>${title} <small style="font-weight:600;color:#667eea"> ‚Äî semaine ${week}</small></h3>
              ${itemsHtml}
            </article>
          `);
          });
          listEl.innerHTML = html.join("");
        } catch (err) {
          loading.textContent =
            "Erreur chargement actus: " + (err.message || err);
        }
      }

      loadActus();
    </script>
  </body>
</html>
